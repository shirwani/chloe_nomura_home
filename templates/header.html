<div class="logo">
    <img class="logo-icon" src="https://chloe-nomura-home.atl1.cdn.digitaloceanspaces.com/website-images/chloe_nomura_icon.jpg" alt="Chloe profile image"/>
    <span class="logo-text">Chloe Nomura Home Furnishing</span>
</div>
<div class="top-nav">
    <div class="container top-nav-inner">
        <div class="top-nav-left">
            {% set selected_categories = request.args.getlist('category') %}
            <div class="dropdown">
                {% if request.endpoint == 'get_inventory' %}
                <button type="button"
                        class="btn btn-link nav-hamburger dropdown-toggle"
                        id="categoryFilterMenu"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false">
                    <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
                </button>
                <div class="dropdown-menu category-filter-menu" aria-labelledby="categoryFilterMenu">
                    <form method="get" action="{{ url_for('get_inventory') }}" style="padding: 10px; min-width: 220px;">
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" name="category" value="Bedroom"
                                       {% if 'Bedroom' in selected_categories %}checked{% endif %}>
                                Bedroom
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" name="category" value="Living Room"
                                       {% if 'Living Room' in selected_categories %}checked{% endif %}>
                                Living Room
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" name="category" value="Study"
                                       {% if 'Study' in selected_categories %}checked{% endif %}>
                                Study
                            </label>
                        </div>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" name="category" value="Other"
                                       {% if 'Other' in selected_categories %}checked{% endif %}>
                                Other
                            </label>
                        </div>
                        <hr style="margin: 8px 0;">
                        <input type="hidden" name="q" value="{{ request.args.get('q', '') }}">
                        <button type="submit" class="btn btn-primary btn-block btn-sm">Apply Filter</button>
                        <a href="{{ url_for('get_inventory') }}" class="btn btn-link btn-block btn-sm">Clear</a>
                    </form>
                </div>
                {% else %}
                <button type="button" class="btn btn-link nav-hamburger">
                    <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span>
                </button>
                {% endif %}
            </div>
            {% if request.endpoint == 'home' %}
            <span class="btn btn-link nav-link-disabled" aria-current="page">Home</span>
            {% else %}
            <a href="{{ url_for('home') }}" class="btn btn-link">Home</a>
            {% endif %}
            {% if request.endpoint == 'get_inventory' %}
            <span class="btn btn-link nav-link-disabled" aria-current="page">Inventory</span>
            {% else %}
            <a href="{{ url_for('get_inventory') }}" class="btn btn-link">Inventory</a>
            {% endif %}
            {% if request.endpoint == 'contact' %}
            <span class="btn btn-link nav-link-disabled" aria-current="page">Contact</span>
            {% else %}
            <a href="{{ url_for('contact') }}" class="btn btn-link">Contact</a>
            {% endif %}
            <form class="top-nav-search" method="get" action="{{ url_for('get_inventory') }}">
                <div class="input-group input-group-sm">
                    <input type="text"
                           class="form-control"
                           name="q"
                           placeholder="Search by name, description, item ID, or category..."
                           value="{{ request.args.get('q', '') }}">
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="submit">
                            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                        </button>
                    </span>
                </div>
            </form>
        </div>
        <div class="top-nav-right">
            <a href="{{ url_for('view_cart') }}" class="btn btn-link nav-cart">
                <span class="glyphicon glyphicon-shopping-cart" aria-hidden="true"></span>
                {% if cart_count %}
                <span class="cart-count">{{ cart_count }}</span>
                {% endif %}
            </a>
            {% if user_first_name %}
                {% if user_is_admin %}
                <a href="{{ url_for('admin_users') }}" class="btn btn-link">Admin</a>
                {% endif %}
                <a href="{{ url_for('profile') }}" class="btn btn-link">
                    <span class="glyphicon glyphicon-user" aria-hidden="true"></span>
                </a>
                <a href="{{ url_for('logout') }}" class="btn btn-link">Logout</a>
            {% elif user_is_guest %}
            <a href="{{ url_for('login', next=request.path) }}" class="btn btn-link">Login</a>
            {% endif %}
        </div>
    </div>
</div>
{# Show the inline login dialog only for anonymous users and
   not on the dedicated auth pages (login/signup/forgot/reset). #}
{% if not user_roles and request.endpoint not in ['login', 'signup', 'forgot_password', 'forgot_password_send_link', 'reset_password'] %}
<div class="login-overlay">
    <div class="login-modal">
        <h3 class="login-title">Welcome to Chloe Nomura Home</h3>
        <p class="login-subtitle">Please log in, sign up, or continue as guest to browse and shop.</p>
        {% if login_error %}
        <div class="alert alert-danger">
            {{ login_error }}
        </div>
        {% endif %}
        <form method="post" action="{{ url_for('login') }}" id="login-form">
            <input type="hidden" name="next" value="{{ request.path }}">

            <div id="login-mode">
                <div class="form-group">
                    <label for="login_email">Email Address</label>
                    <input type="email"
                           class="form-control"
                           id="login_email"
                           name="email"
                           required>
                </div>
                <div class="form-group">
                    <label for="login_password">Password</label>
                    <input type="password"
                           class="form-control"
                           id="login_password"
                           name="password">
                </div>
                <div class="login-actions">
                    <button type="submit" name="action" value="login" class="btn btn-primary">
                        Login
                    </button>
                    <a href="{{ url_for('signup') }}" class="btn btn-default">
                        Sign Up
                    </a>
                    <button type="submit"
                            name="action"
                            value="guest"
                            class="btn btn-link"
                            onclick="prepareGuestContinue()">
                        Continue as Guest
                    </button>
                </div>
                <div style="margin-top: 10px;">
                    <button type="button"
                            class="btn btn-link"
                            onclick="showForgotPasswordMode()">
                        Forgot password?
                    </button>
                </div>
            </div>

            <div id="forgot-password-mode" style="display: none;">
                <div class="form-group">
                    <label for="fp_email_inline">Email Address</label>
                    <input type="email"
                           class="form-control"
                           id="fp_email_inline"
                           name="reset_email">
                </div>
                <div class="login-actions">
                    <button type="submit"
                            class="btn btn-primary"
                            formaction="{{ url_for('forgot_password_send_link') }}"
                            formmethod="post">
                        Send Reset Password Link
                    </button>
                    <button type="submit"
                            name="action"
                            value="guest"
                            class="btn btn-link"
                            onclick="prepareGuestContinue()">
                        Continue as Guest
                    </button>
                </div>
                <div style="margin-top: 10px;">
                    <button type="button"
                            class="btn btn-link"
                            onclick="showLoginMode()">
                        Back to Login
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
{% endif %}
<script>
function prepareGuestContinue() {
  var email1 = document.getElementById('login_email');
  var email2 = document.getElementById('fp_email_inline');
  if (email1) {
    email1.removeAttribute('required');
  }
  if (email2) {
    email2.removeAttribute('required');
  }
}
function showForgotPasswordMode() {
  var login = document.getElementById('login-mode');
  var forgot = document.getElementById('forgot-password-mode');
  var email1 = document.getElementById('login_email');
  var email2 = document.getElementById('fp_email_inline');
  if (login && forgot) {
    login.style.display = 'none';
    forgot.style.display = 'block';
  }
  if (email1) {
    email1.removeAttribute('required');
  }
  if (email2) {
    email2.setAttribute('required', 'required');
  }
}
function showLoginMode() {
  var login = document.getElementById('login-mode');
  var forgot = document.getElementById('forgot-password-mode');
  var email1 = document.getElementById('login_email');
  var email2 = document.getElementById('fp_email_inline');
  if (login && forgot) {
    forgot.style.display = 'none';
    login.style.display = 'block';
  }
  if (email2) {
    email2.removeAttribute('required');
  }
  if (email1) {
    email1.setAttribute('required', 'required');
  }
}
</script>
{% if login_forgot_mode %}
<script>
  // When coming back from "Send Reset Password Link", reopen the forgot-password
  // view so the user sees the confirmation message alongside the email field.
  showForgotPasswordMode();
</script>
{% endif %}
